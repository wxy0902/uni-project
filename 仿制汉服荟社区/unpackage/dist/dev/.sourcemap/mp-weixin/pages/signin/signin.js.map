{"version":3,"sources":["uni-app:///main.js","webpack:////Users/wangxinyao/Documents/HBuilderProjects/project/仿制汉服荟社区/pages/signin/signin.vue?6824","webpack:////Users/wangxinyao/Documents/HBuilderProjects/project/仿制汉服荟社区/pages/signin/signin.vue?fbfd","webpack:////Users/wangxinyao/Documents/HBuilderProjects/project/仿制汉服荟社区/pages/signin/signin.vue?c170","webpack:////Users/wangxinyao/Documents/HBuilderProjects/project/仿制汉服荟社区/pages/signin/signin.vue?071d","uni-app:///pages/signin/signin.vue"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA,wCAAmB;AACnB;AACA,gG;AACAA,UAAU,CAACC,eAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAmH;AACnH;AAC0D;AACL;;;AAGrD;AACmN;AACnN,gBAAgB,iNAAU;AAC1B,EAAE,4EAAM;AACR,EAAE,iFAAM;AACR,EAAE,0FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,qFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA,WAAW,sQAEN;AACL,GAAG;AACH;AACA,WAAW,kOAEN;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AAAm1B,CAAgB,oyBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACqCv2B;;;;AAIA,uE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;8XAUA,EACA,cACA,8BADA,EADA,EAIA,IAJA,kBAIA,CACA,SACA;AACA,4BAFA,EAGA,eAHA,EAIA;AACA,wBALA,EAMA;AACA,uBAPA,GASA,CAdA,EAgBA,YACA;AACA,kBAFA,4BAEA,CACA,gDACA,CAJA,EAKA;AACA,sBANA,gCAMA,CACA,oDACA,CARA,CASA;AATA,GAhBA,EA4BA,MA5BA,kBA4BA,OA5BA,EA4BA,kBACA,4BACA;AACA,mEACA;AACA,sEAFA,CAGA;AACA;AACA,uBADA;AAEA,0BAFA;AAGA,iBAHA;AAIA,iBAJA;AAKA,mBALA;;AAOA,OAXA,EAWA,IAXA,CAWA;AACA;AACA;AACA;AACA;AACA,OAhBA;AAiBA;AACA,GAjDA;;AAmDA;AACA;AACA,eAFA,uBAEA,GAFA,EAEA;AACA;AACA;AACA,KALA;AAMA;AACA,gBAPA,0BAOA;AACA;AACA;AACA;AACA,OAHA,EAGA,IAHA;AAIA,KAZA;AAaA;AACA,YAdA,sBAcA;AACA;AACA;AACA;AACA,oBADA;AAEA,kBAFA;;AAIA;AACA;AACA;AACA,mFADA;AAEA,sBAFA;;AAIA;AACA;AACA,OARA,EAQA,IARA,CAQA;AACA;AACA;AACA;AACA;AACA,OAbA,EAaA,KAbA,CAaA;AACA;AACA;AACA,OAhBA;AAiBA,KAtCA;AAuCA;AACA,kBAxCA,4BAwCA;AACA;AACA,iDADA;;AAGA,KA5CA;AA6CA;AACA,cA9CA,sBA8CA,EA9CA,EA8CA,KA9CA,EA8CA;AACA;AACA;AACA,yBADA;AAEA;AACA;AACA;AACA;AACA,0BADA;AAEA,wBAFA;;AAIA;AACA,wBADA;AAEA,8BAFA;AAGA,wBAHA;AAIA,gBAJA,CAIA;AACA;AACA;AACA,6BADA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAhBA,EAgBA,KAhBA,CAgBA;AACA;AACA,aAlBA;AAmBA;AACA,SA7BA;;AA+BA;AACA;AAhFA,GAnDA;;AAsIA,eAtIA,2BAsIA;AACA;AACA,GAxIA,E","file":"pages/signin/signin.js","sourcesContent":["import 'uni-pages';import '@dcloudio/uni-stat';\nimport Vue from 'vue'\nimport Page from './pages/signin/signin.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./signin.vue?vue&type=template&id=23701386&\"\nvar renderjs\nimport script from \"./signin.vue?vue&type=script&lang=js&\"\nexport * from \"./signin.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/signin/signin.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./signin.vue?vue&type=template&id=23701386&\"","var components = {\n  mescrollUni: function() {\n    return import(\n      /* webpackChunkName: \"components/mescroll-uni/mescroll-uni\" */ \"@/components/mescroll-uni/mescroll-uni.vue\"\n    )\n  },\n  signinCalendar: function() {\n    return import(\n      /* webpackChunkName: \"components/signin-calendar/signin-calendar\" */ \"@/components/signin-calendar/signin-calendar.vue\"\n    )\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.signinShopListData, function(item, index) {\n    var $orig = _vm.__get_orig(item)\n\n    var m0 = _vm.calDatetime(item.Orders.Datetime)\n    return {\n      $orig: $orig,\n      m0: m0\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./signin.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./signin.vue?vue&type=script&lang=js&\"","<template>\r\n  <view>\r\n    <!-- 滚动内容区 -->\r\n    <mescroll-uni :down=\"{use:false}\" :up=\"{use:false}\">\r\n      <!-- 签到信息 -->\r\n      <view class=\"bgwhite mb18r fcenter ptb28r\">\r\n        <view class=\"f32r c555 mb18r\">今日第 <text class=\"f36r ctheme mlr18r\">{{signinInfoData.order}}</text> 个签到</view>\r\n        <view class=\"f28r cgray\">距明日抢签到还有 <text class=\"ml8r\">{{remaiTime}}</text></view>\r\n        <button class=\"btn-sub w44v mtb28r\" hover-class=\"btn-hover\" :disabled=\"signinInfoData.issignin\" @tap=\"fnSignin\">{{signinInfoData.issignin?'已签到':'签 到'}}</button>\r\n        <view class=\"f28r cgray\">已连续签到{{signinInfoData.connect}}天，共漏签{{signinInfoData.miss}}天</view>\r\n      </view>\r\n      <!-- 签到日历 -->\r\n      <signin-calendar ref=\"signinCalendar\"></signin-calendar>\r\n      <view class=\"hl80r f32r fcenter c555 bgwhite bts2r mb18r\" @tap=\"fnSigninRecord\">奖励记录</view>\r\n      <!-- 补签卡兑换 -->\r\n      <block v-for=\"(item,index) in signinShopListData\" :key=\"index\">\r\n        <view class=\"bgwhite mb18r\">\r\n          <view class=\"bbs2r ptb18r plr18r flex\">\r\n            <image class=\"hw200r br8r mr18r\" :src=\"item.ImgSrc + '_200x200.jpg'\" mode=\"aspectFill\"></image>\r\n            <view class=\"flex-fitem flexc-jsa\">\r\n              <view class=\"f28r c555\">{{item.Name}}</view>\r\n              <view class=\"f28r ctheme hl80r bbdash2r\"><text class=\"f36r mr8r\">{{item.Price}}</text>汉币</view>\r\n              <view class=\"f24r cgray\">\r\n                <text class=\"ctheme mr8r\">{{item.Orders.User.NickName}}</text> {{calDatetime(item.Orders.Datetime)}}分钟前换取了\r\n              </view>\r\n            </view>\r\n          </view>\r\n          <view class=\"flexr-jfe ptb18r plr18r\">\r\n            <view class=\"f28r bgtheme cwhite br8r plr18r ptb18r\" @tap=\"fnHanbiExc(item.ID,item.Price)\">汉币兑换</view>\r\n          </view>\r\n        </view>\r\n      </block>\r\n    </mescroll-uni>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\n  import {\r\n    fnFormatDate,\r\n    fnSecondToTime\r\n  } from \"@/utils/CommonUtil.js\"\r\n  import {\r\n    getSigninInfo,\r\n    getHanbiShopList,\r\n    addSignin,\r\n    addHanbiOrders\r\n  } from \"@/api/HanbiServer.js\"\r\n\r\n  // 签到日历组件\r\n  import SigninCalendar from \"@/components/signin-calendar/signin-calendar.vue\"\r\n\r\n  export default {\r\n    components: {\r\n      SigninCalendar\r\n    },\r\n    data() {\r\n      return {\r\n        // 距明日倒计时\r\n        remaiTime: '00时00分00秒',\r\n        timeInter: null,\r\n        // 签到状态\r\n        signinState: false,\r\n        // 兑换状态\r\n        orderState: false\r\n      }\r\n    },\r\n\r\n    computed: {\r\n      // 签到信息\r\n      signinInfoData() {\r\n        return this.$store.getters['getSigninInfoData']\r\n      },\r\n      // 签到商品列表\r\n      signinShopListData() {\r\n        return this.$store.getters['getSigninShopListData']\r\n      },\r\n      //\r\n    },\r\n\r\n    onLoad(options) {\r\n      if (options && options.id) {\r\n        // 获取签到信息 \r\n        getSigninInfo().then(signinRes => {\r\n          // 保存签到信息\r\n          this.$store.commit('setSigninInfoData', signinRes.data.Data)\r\n          // 获取汉币兑换签到商品\r\n          return getHanbiShopList({\r\n            tag: 'signin',\r\n            haveorders: true,\r\n            role: 5,\r\n            page: 1,\r\n            count: 10\r\n          })\r\n        }).then(shopRes => {\r\n          // 保存签到商品列表\r\n          this.$store.commit('setSigninShopListData', shopRes.data.Data)\r\n          // 触发倒计时\r\n          this.calRemaiTime()\r\n        })\r\n      }\r\n    },\r\n\r\n    methods: {\r\n      /// 计算格式友好时间 几天前\r\n      calDatetime(str) {\r\n        let timestamp = new Date(str).getTime();\r\n        return fnFormatDate(timestamp);\r\n      },\r\n      // 倒计时明日签到时间\r\n      calRemaiTime() {\r\n        this.timeInter = setInterval(() => {\r\n          this.remaiTime = fnSecondToTime(this.signinInfoData.timecount);\r\n          this.signinInfoData.timecount--\r\n        }, 1000)\r\n      },\r\n      /// 签到\r\n      fnSignin() {\r\n        if (this.signinInfoData.issignin || this.signinState) return\r\n        this.signinState = true\r\n        uni.showLoading({\r\n          title: '签到中',\r\n          mask: true\r\n        })\r\n        addSignin().then(res => {\r\n          uni.hideLoading()\r\n          uni.showToast({\r\n            title: `签到奖励 ${res.data.Data} 汉币`,\r\n            icon: 'none'\r\n          })\r\n          // this.signinState = false\r\n          return getSigninInfo()\r\n        }).then(signinRes => {\r\n          // 保存签到信息\r\n          this.$store.commit('setSigninInfoData', signinRes.data.Data)\r\n          // 重新初始签到日历\r\n          this.$refs.signinCalendar.init()\r\n        }).catch((e) => {\r\n          console.log(e);\r\n          this.signinState = false\r\n        })\r\n      },\r\n      /// 跳转签到奖励记录\r\n      fnSigninRecord() {\r\n        uni.navigateTo({\r\n          url: '/pages/signin-record/signin-record'\r\n        })\r\n      },\r\n      /// 汉币兑换\r\n      fnHanbiExc(id,price) {\r\n        if (this.orderState) return\r\n        uni.showModal({\r\n          content: '确认兑换吗？',\r\n          success: res => {\r\n            if (res.confirm) {\r\n              this.orderState = true\r\n              uni.showLoading({\r\n                title: '兑换中',\r\n                mask: true\r\n              })\r\n              addHanbiOrders({\r\n                shopid: id,\r\n                useraddressid: 0,\r\n                remark: '',\r\n              }).then(res => {\r\n                uni.hideLoading()\r\n                uni.showToast({\r\n                  title: '兑换成功'\r\n                })\r\n                this.orderState = false;\r\n                // 登录用户汉币数减少\r\n                let tempUser = this.$store.getters['user/getUserInfoData']\r\n                tempUser.Hanbi = Number(tempUser.Hanbi) - Number(price)\r\n                this.$store.commit('user/setUserInfoData', tempUser)\r\n                // 重新初始签到日历\r\n                this.$refs.signinCalendar.init()\r\n              }).catch(() => {\r\n                this.orderState = false;\r\n              })\r\n            }\r\n          }\r\n        })\r\n      }\r\n      //\r\n    },\r\n\r\n    beforeDestroy() {\r\n      clearInterval(this.timeInter)\r\n    }\r\n  }\r\n</script>\r\n\r\n<style>\r\n\r\n</style>\n"],"sourceRoot":""}